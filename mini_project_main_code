#include<reg52.h>
#include<string.h>
#include<stdio.h>
#include"lcd4bit.h"

//#define lcdport P1
//sbit RS=P1^0;
//sbit RW=P1^1;
//sbit EN=P1^2;


sbit buzzer=P2^6;
char i,rx_data[50];
char rfid[13],ch=0;
int count1, count2, count3;
unsigned char result[1];

void uart_init()
{
 TMOD=0x20;
 SCON=0x50;
 TH1=0xfd;
 TR1=1;
}
char rxdata()
{
  while(!RI);
    ch=SBUF;    
    RI=0;
    return ch;
}
void main()
{
    buzzer=1;
    uart_init();
    lcd_Init();
     print("  RFID Based    ");
    set_cursor(0,1);
    print("Attendance Systm"); 
    delay(2000);
	  clr();
    while(1)
    {
        set_cursor(0,0);
        print("Place Your Card:");
        //set_cursor(0,1);
        i=0;
        for(i=0;i<12;i++)
        rfid[i]=rxdata();
        rfid[i]='\0';
        set_cursor(0,0);
        print("Your ID No. is:");
        set_cursor(0,1);
        for(i=0;i<12;i++)
        lcddata(rfid[i]);
        delay(100);
        if(strncmp(rfid,"160066A5EC39",12)==0)
        {
            count1++;
            set_cursor(0,0);
            print(" Attendance ");
            set_cursor(0,1);
            print(" Registered");
            delay(200);
            set_cursor(0,0);
            print(" Student1 ");
            set_cursor(0,1);
            print("Attnd. No.: ");
           sprintf(result, "%d", count1);
            print(result);
            
            
           
            
        }
        else if(strncmp(rfid,"160066BD7AB7",12)==0)
            {
            count2++;
            set_cursor(0,0);
            print(" Attendance ");
            set_cursor(0,1);
            print(" Registered");
            delay(200);
            set_cursor(0,0);
            print(" Student2 ");
            set_cursor(0,1);
            print("Attnd. No.: ");
            sprintf(result, "%d", count2);
            print(result);
           
      }
           
           
            
        else 
        {
           set_cursor(0,0);
           print("Invalid Card");
           buzzer=0;
           delay(300);
           buzzer=1;
        }
  }
}